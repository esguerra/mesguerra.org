# ==================================================================
# Calculation for G1 in adh026 and its paired base C8
# ==================================================================
S=load("S_G.dat");
E=load("E_G1.dat");
N=9;
i=ones(N,1);
C=(1/(N-1))*((S'*E)-((1/N)*S'*i*i'*E));

M=[C(1,1)+C(2,2)+C(3,3),    C(2,3)-C(3,2),         C(3,1)-C(1,3),            C(1,2)-C(2,1);
      C(2,3)-C(3,2),     C(1,1)-C(2,2)-C(3,3),     C(1,2)+C(2,1),            C(3,1)+C(1,3);
      C(3,1)-C(1,3),        C(1,2)+C(2,1),     -C(1,1)+C(2,2)-C(3,3),        C(2,3)+C(3,2);
      C(1,2)-C(2,1),        C(3,1)+C(1,3),         C(2,3)+C(3,2),       -C(1,1)-C(2,2)+C(3,3)];

[q,lambda]=eig(M)

R_G1=[q(1,4)*q(1,4)+q(2,4)*q(2,4)-q(3,4)*q(3,4)-q(4,4)*q(4,4),    2*(q(2,4)*q(3,4)-q(1,4)*q(4,4)),     2*(q(2,4)*q(4,4)+q(1,4)*q(3,4));
   2*(q(3,4)*q(2,4)+q(1,4)*q(4,4)),   q(1,4)*q(1,4)-q(2,4)*q(2,4)+q(3,4)*q(3,4)-q(4,4)*q(4,4),    2*(q(3,4)*q(4,4)-q(1,4)*q(2,4));
  2*(q(4,4)*q(2,4)-q(1,4)*q(3,4)),  2*(q(4,4)*q(3,4)+q(1,4)*q(2,4)),   q(1,4)*q(1,4)-q(2,4)*q(2,4)-q(3,4)*q(3,4)+q(4,4)*q(4,4)]


o_G1 = mean(E) - mean(S)*R_G1'


U = ones(N,1);

O = U*o_G1;

F = (S * R_G1') + O

D = E - F

suma = sumsq(D)
RMSD = sqrt((suma(1,1)+suma(1,2)+suma(1,3))/N)

# ==================================================================
# C8 calculation starts here
# ==================================================================

S=load("S_C.dat");
E=load("E_C8.dat");
N=6;
i=ones(N,1);
C=(1/(N-1))*((S'*E)-((1/N)*S'*i*i'*E));

M=[C(1,1)+C(2,2)+C(3,3),    C(2,3)-C(3,2),         C(3,1)-C(1,3),            C(1,2)-C(2,1);
      C(2,3)-C(3,2),     C(1,1)-C(2,2)-C(3,3),     C(1,2)+C(2,1),            C(3,1)+C(1,3);
      C(3,1)-C(1,3),        C(1,2)+C(2,1),     -C(1,1)+C(2,2)-C(3,3),        C(2,3)+C(3,2);
      C(1,2)-C(2,1),        C(3,1)+C(1,3),         C(2,3)+C(3,2),       -C(1,1)-C(2,2)+C(3,3)];


[q,lambda]=eig(M)

R=[q(1,4)*q(1,4)+q(2,4)*q(2,4)-q(3,4)*q(3,4)-q(4,4)*q(4,4),    2*(q(2,4)*q(3,4)-q(1,4)*q(4,4)),     2*(q(2,4)*q(4,4)+q(1,4)*q(3,4));
   2*(q(3,4)*q(2,4)+q(1,4)*q(4,4)),   q(1,4)*q(1,4)-q(2,4)*q(2,4)+q(3,4)*q(3,4)-q(4,4)*q(4,4),    2*(q(3,4)*q(4,4)-q(1,4)*q(2,4));
  2*(q(4,4)*q(2,4)-q(1,4)*q(3,4)),  2*(q(4,4)*q(3,4)+q(1,4)*q(2,4)),   q(1,4)*q(1,4)-q(2,4)*q(2,4)-q(3,4)*q(3,4)+q(4,4)*q(4,4)]

R_C8 = [R(:,1), -1*R(:,2), -1*R(:,3)]

o_C8 = mean(E) - mean(S)*R'


U = ones(N,1);

O = U*o_C8;

F = (S * R') + O

D = E - F

suma = sumsq(D)
RMSD = sqrt((suma(1,1)+suma(1,2)+suma(1,3))/N)

# ==================================================================
# Calculation for G2 in adh026
# ==================================================================

S=load("S_G.dat");
E=load("E_G2.dat");
N=9;
i=ones(N,1);
C=(1/(N-1))*((S'*E)-((1/N)*S'*i*i'*E))

M=[C(1,1)+C(2,2)+C(3,3),    C(2,3)-C(3,2),         C(3,1)-C(1,3),            C(1,2)-C(2,1);
      C(2,3)-C(3,2),     C(1,1)-C(2,2)-C(3,3),     C(1,2)+C(2,1),            C(3,1)+C(1,3);
      C(3,1)-C(1,3),        C(1,2)+C(2,1),     -C(1,1)+C(2,2)-C(3,3),        C(2,3)+C(3,2);
      C(1,2)-C(2,1),        C(3,1)+C(1,3),         C(2,3)+C(3,2),       -C(1,1)-C(2,2)+C(3,3)];

[q,lambda]=eig(M)

R_G2=[q(1,4)*q(1,4)+q(2,4)*q(2,4)-q(3,4)*q(3,4)-q(4,4)*q(4,4),    2*(q(2,4)*q(3,4)-q(1,4)*q(4,4)),     2*(q(2,4)*q(4,4)+q(1,4)*q(3,4));
   2*(q(3,4)*q(2,4)+q(1,4)*q(4,4)),   q(1,4)*q(1,4)-q(2,4)*q(2,4)+q(3,4)*q(3,4)-q(4,4)*q(4,4),    2*(q(3,4)*q(4,4)-q(1,4)*q(2,4));
  2*(q(4,4)*q(2,4)-q(1,4)*q(3,4)),  2*(q(4,4)*q(3,4)+q(1,4)*q(2,4)),   q(1,4)*q(1,4)-q(2,4)*q(2,4)-q(3,4)*q(3,4)+q(4,4)*q(4,4)]


o_G2 = mean(E) - mean(S)*R_G2'

U = ones(N,1);

O = U*o_G2;

F = (S * R_G2') + O

D = E - F

suma = sumsq(D)
RMSD = sqrt((suma(1,1)+suma(1,2)+suma(1,3))/N)


# ==================================================================
# Calculation for C7 in adh026
# ==================================================================

S=load("S_C.dat");
E=load("E_C7.dat");
N=6;
i=ones(N,1);
C=(1/(N-1))*((S'*E)-((1/N)*S'*i*i'*E))

M=[C(1,1)+C(2,2)+C(3,3),    C(2,3)-C(3,2),         C(3,1)-C(1,3),            C(1,2)-C(2,1);
      C(2,3)-C(3,2),     C(1,1)-C(2,2)-C(3,3),     C(1,2)+C(2,1),            C(3,1)+C(1,3);
      C(3,1)-C(1,3),        C(1,2)+C(2,1),     -C(1,1)+C(2,2)-C(3,3),        C(2,3)+C(3,2);
      C(1,2)-C(2,1),        C(3,1)+C(1,3),         C(2,3)+C(3,2),       -C(1,1)-C(2,2)+C(3,3)];

[q,lambda]=eig(M)

R=[q(1,4)*q(1,4)+q(2,4)*q(2,4)-q(3,4)*q(3,4)-q(4,4)*q(4,4),    2*(q(2,4)*q(3,4)-q(1,4)*q(4,4)),     2*(q(2,4)*q(4,4)+q(1,4)*q(3,4));
   2*(q(3,4)*q(2,4)+q(1,4)*q(4,4)),   q(1,4)*q(1,4)-q(2,4)*q(2,4)+q(3,4)*q(3,4)-q(4,4)*q(4,4),    2*(q(3,4)*q(4,4)-q(1,4)*q(2,4));
  2*(q(4,4)*q(2,4)-q(1,4)*q(3,4)),  2*(q(4,4)*q(3,4)+q(1,4)*q(2,4)),   q(1,4)*q(1,4)-q(2,4)*q(2,4)-q(3,4)*q(3,4)+q(4,4)*q(4,4)]

R_C7 = [R(:,1), -1*R(:,2), -1*R(:,3)]

o_C7 = mean(E) - mean(S)*R'

U = ones(N,1);

O = U*o_C7;

F = (S * R') + O

D = E - F

suma = sumsq(D)
RMSD = sqrt((suma(1,1)+suma(1,2)+suma(1,3))/N)


# =================================================================
# Standard Reference frames for base-pairs
# =================================================================

o_G1C8 = (o_G1 + o_C8)/2
R_G1C8 = (R_G1 + R_C8)/2


o_G2C7 = (o_G2 + o_C7)/2
R_G2C7 = (R_G2 + R_C7)/2

h = cross(R_G2C7(:,1) - R_G1C8(:,1), R_G2C7(:,2) - R_G1C8(:,2)) 
     n=( 1 / sqrt(dot(h,h)));
     h_norm = n*h'
     dot(h_norm, h_norm);
